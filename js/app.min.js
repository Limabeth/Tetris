(()=>{"use strict";const t={minLevel:1,maxLevel:5},i=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],e={width:590,height:630,borderWidth:5,playFieldWidth:360,playFieldHeight:620,rows:20,columns:10},s={1:40,2:100,3:300,4:1200},h=[{piece:{matrix:[[1,1,1],[0,1,0],[0,0,0]],rotations:[[[1,1,1],[0,1,0],[0,0,0]],[[0,1,0],[1,1,0],[0,1,0]],[[0,1,0],[1,1,1],[0,0,0]],[[1,0,0],[1,1,0],[1,0,0]]],type:"T"}},{piece:{matrix:[[2,2,0],[0,2,2],[0,0,0]],rotations:[[[2,2,0],[0,2,2],[0,0,0]],[[0,2,0],[2,2,0],[2,0,0]],[[2,2,0],[0,2,2],[0,0,0]],[[0,2,0],[2,2,0],[2,0,0]]],type:"Z"}},{piece:{matrix:[[0,3,3],[3,3,0],[0,0,0]],rotations:[[[0,3,3],[3,3,0],[0,0,0]],[[3,0,0],[3,3,0],[0,3,0]],[[0,3,3],[3,3,0],[0,0,0]],[[3,0,0],[3,3,0],[0,3,0]]],type:"S"}},{piece:{matrix:[[4,4,4],[0,0,4],[0,0,0]],rotations:[[[4,4,4],[0,0,4],[0,0,0]],[[0,4,0],[0,4,0],[4,4,0]],[[4,0,0],[4,4,4],[0,0,0]],[[4,4,0],[4,0,0],[4,0,0]]],type:"J"}},{piece:{matrix:[[5,5,5],[5,0,0],[0,0,0]],rotations:[[[5,5,5],[5,0,0],[0,0,0]],[[5,5,0],[0,5,0],[0,5,0]],[[0,0,5],[5,5,5],[0,0,0]],[[5,0,0],[5,0,0],[5,5,0]]],type:"L"}},{piece:{matrix:[[6,6,6,6],[0,0,0,0],[0,0,0,0],[0,0,0,0]],rotations:[[[6,6,6,6],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[6,0,0,0],[6,0,0,0],[6,0,0,0],[6,0,0,0]],[[6,6,6,6],[0,0,0,0],[0,0,0,0],[0,0,0,0]],[[6,0,0,0],[6,0,0,0],[6,0,0,0],[6,0,0,0]]],type:"I"}},{piece:{matrix:[[7,7,0],[7,7,0],[0,0,0]],rotations:[[[7,7,0],[7,7,0],[0,0,0]],[[7,7,0],[7,7,0],[0,0,0]],[[7,7,0],[7,7,0],[0,0,0]],[[7,7,0],[7,7,0],[0,0,0]]],type:"O"}}],l={1:"#107DC2",2:"#67AD19",3:"#E34B36",4:"#E2C61A",5:"#FF8009",6:"#117CC4",7:"#683B8E"},c={colorPrimary:"#FFFFFF",fontFamily:"PressStart2P",fontSizeSmall:"14px",fontSizeMedium:"18px",fontSizeBig:"24px"},n=t=>t.map((t=>t.slice()));class r{constructor(t,i,e,s){this.settings=t,this.cvsConfig=e,this.score=s,this.playing=!1,this.isGameOver=!1,this.lines=0,this.level=this.settings.minLevel,this.playFieldClean=n(i),this.playFieldActive=n(i),this.playFieldLocked=n(i)}checkForFullRows(){const t=this.cvsConfig.rows,i=[];t:for(let e=t-1;e>=0;e--){const t=this.playFieldLocked[e];for(let i=0;i<t.length;i++)if(!t[i])continue t;i.unshift(e)}0!==i.length&&(this.playing=!1,this.showFullRows(i),setTimeout((()=>{this.clearFullRows(i),this.playing=!0}),500))}showFullRows(t){const i=this.cvsConfig.columns,e=new Array(i).fill(99);t.forEach((t=>{this.playFieldActive[t]=e}))}clearFullRows(t){const i=this.cvsConfig.columns,e=new Array(i).fill(0);t.forEach((t=>{this.playFieldLocked.splice(t,1),this.playFieldLocked.unshift(e)})),this.playFieldActive=n(this.playFieldLocked);const s=t.length;this.lines+=s,this.score.update(s,this.level),this.updateLevel()}updateLevel(){const t=Math.ceil(.1*this.lines);t>this.settings.maxLevel||(this.level=this.level>t?this.level:t)}endGame(){this.isGameOver=!0,this.playing=!1}reset(){this.score.reset(),this.lines=0,this.level=this.settings.minLevel,this.playFieldActive=n(this.playFieldClean),this.playFieldLocked=n(this.playFieldClean),this.isGameOver=!1}}class o{constructor(t,i,e,s,h,l,c){this.game=t,this.score=e,this.piece=i,this.cvsConfig=h,this.colorsConfig=l,this.fontConfig=c,this.el=s,this.cvs=null,this.ctx=null,this.cvsWidth=this.cvsConfig.width,this.cvsHeight=this.cvsConfig.height,this.cellWidth=null,this.cellHeight=null,this.gap=30,this.borderWidth=this.cvsConfig.borderWidth,this.frameX=this.borderWidth,this.frameY=this.borderWidth,this.playFieldX=this.frameX,this.playFieldY=this.frameY,this.playFieldWidth=this.cvsConfig.playFieldWidth,this.playFieldHeight=this.cvsConfig.playFieldHeight,this.sidePanelX=this.playFieldWidth+this.gap,this.sidePanelY=0,this.sidePanelWidth=this.cvsWidth/3,this.sidePanelHeight=this.cvsHeight}init(){this.piece.create(),this.createCanvas(),this.calculateDimensions(),this.renderStartScreen()}createCanvas(){const{width:t,height:i}=this.cvsConfig,e=document.createElement("canvas");this.cvs=e,this.ctx=e.getContext("2d"),this.cvs.width=t,this.cvs.height=i,this.el.appendChild(this.cvs)}calculateDimensions(){const{rows:t,columns:i}=this.cvsConfig;this.cellWidth=this.playFieldWidth/i,this.cellHeight=this.playFieldHeight/t}render(){this.clear(),this.renderFrame(),this.renderPlayFieldBackground(),this.renderSidePanel();const t=this.game.playFieldActive;for(let i=0;i<t.length;i++)for(let e=0;e<t[i].length;e++){const s=t[i][e];0!==s&&99!==s?this.renderPiece(i,e,s):99===s&&this.renderFullCell(i,e)}}renderFrame(){this.ctx.strokeStyle="rgb(50, 50, 50)",this.ctx.lineWidth=this.borderWidth,this.ctx.strokeRect(this.frameX,this.frameY,this.playFieldWidth,this.playFieldHeight)}renderPlayFieldBackground(){this.ctx.fillStyle="rgb(18, 18, 18)",this.ctx.fillRect(this.playFieldX,this.playFieldY,this.playFieldWidth,this.playFieldHeight)}renderStartScreen(){this.clear();const{colorPrimary:t,fontFamily:i,fontSizeBig:e}=this.fontConfig;this.ctx.beginPath(),this.ctx.fillStyle=t,this.ctx.font=`${e} ${i}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("Press ENTER to start",this.cvsWidth/2,this.cvsHeight/2),this.ctx.closePath()}renderPauseScreen(){const{colorPrimary:t,fontFamily:i,fontSizeBig:e}=this.fontConfig;this.ctx.beginPath(),this.ctx.fillStyle="rgba(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.cvsWidth,this.cvsHeight),this.ctx.fillStyle=t,this.ctx.font=`${e} ${i}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("RESUME",this.cvsWidth/2,this.cvsHeight/2),this.ctx.closePath()}renderGameOverScreen(){this.clear();const{colorPrimary:t,fontFamily:i,fontSizeMedium:e}=this.fontConfig;this.ctx.fillStyle=t,this.ctx.font=`${e} ${i}`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("GAME OVER",this.cvsWidth/2,this.cvsHeight/2),this.ctx.fillText(`Score: ${this.score.score}`,this.cvsWidth/2,this.cvsHeight/2+50),this.ctx.fillText("Press ENTER to start a new game",this.cvsWidth/2,this.cvsHeight/2+100)}renderFullCell(t,i){this.ctx.fillStyle="#D81C38",this.ctx.strokeStyle="rgb(25, 25, 25)",this.ctx.lineWidth=1,this.ctx.fillRect(this.playFieldX+i*this.cellWidth,this.playFieldY+t*this.cellHeight,this.cellWidth,this.cellHeight),this.ctx.strokeRect(this.playFieldX+i*this.cellWidth,this.playFieldY+t*this.cellHeight,this.cellWidth,this.cellHeight)}renderPiece(t,i,e){const s=this.colorsConfig[e];this.ctx.fillStyle=s,this.ctx.strokeStyle="rgb(25, 25, 25)",this.ctx.lineWidth=1,this.ctx.fillRect(this.playFieldX+i*this.cellWidth,this.playFieldY+t*this.cellHeight,this.cellWidth,this.cellHeight),this.ctx.strokeRect(this.playFieldX+i*this.cellWidth,this.playFieldY+t*this.cellHeight,this.cellWidth,this.cellHeight)}renderSidePanel(){this.ctx.textAlign="start",this.ctx.fillStyle="white",this.ctx.font="10px PressStart2P",this.ctx.fillText(`SCORE: ${this.score.score}`,this.sidePanelX,this.sidePanelY+20),this.ctx.fillText(`LINES: ${this.game.lines}`,this.sidePanelX,this.sidePanelY+60),this.ctx.fillText(`LEVEL: ${this.game.level}`,this.sidePanelX,this.sidePanelY+100),this.ctx.fillText("NEXT: ",this.sidePanelX,this.sidePanelY+160);const t=this.piece.nextPiece;for(let i=0;i<t.matrix.length;i++)for(let e=0;e<t.matrix[i].length;e++){const s=t.matrix[i][e];if(0!==s){const t=this.colorsConfig[s];this.ctx.fillStyle=t,this.ctx.strokeStyle="black",this.ctx.lineWidth=1,this.ctx.fillRect(this.sidePanelX+e*this.cellWidth,this.sidePanelY+i*this.cellHeight+220,this.cellWidth,this.cellHeight),this.ctx.strokeRect(this.sidePanelX+e*this.cellWidth,this.sidePanelY+i*this.cellHeight+220,this.cellWidth,this.cellHeight)}}}clear(){this.ctx.clearRect(0,0,this.cvsWidth,this.cvsHeight)}}class a{constructor(t,i,e){this.game=t,this.piecesConfig=i,this.cvsConfig=e,this.currentPiece=null,this.nextPiece=null,this.x=0,this.y=-1,this.rotation=0}init(){this.reset(),this.currentPiece=this.create(),this.nextPiece=this.create(),this.positionCurrentPiece()}create(){const t=function(t,i){return Math.floor(Math.random()*(i-t+1)+t)}(0,this.piecesConfig.length-1);return this.piecesConfig[t].piece}positionCurrentPiece(){const t=this.currentPiece.matrix[0].length,i=Math.floor(this.cvsConfig.columns/2)-Math.floor(t/2);this.x=i,this.checkForCollision(this.currentPiece.matrix,this.y+1,this.x)&&this.game.endGame()}reset(){this.y=-1,this.rotation=0}moveRight(){this.x+=1,this.checkForCollision()&&(this.x-=1),this.updatePosition()}moveLeft(){this.x-=1,this.checkForCollision()&&(this.x+=1),this.updatePosition()}moveDown(){if(this.y+=1,this.checkForCollision())return this.y-=1,this.lock(),void this.game.checkForFullRows();this.updatePosition()}rotate(){let t,i=this.rotation;this.rotation===this.currentPiece.rotations.length-1?i=0:i+=1,t=this.currentPiece.rotations[i],this.checkForCollision(t)||(this.rotation=i,this.updateMatrix(),this.updatePosition())}updateMatrix(){this.currentPiece.matrix=this.currentPiece.rotations[this.rotation]}checkForCollision(t=this.currentPiece.matrix,i=this.y,e=this.x){for(let s=0;s<t.length;s++)for(let h=0;h<t[s].length;h++){const l=t[s][h];if(!l)continue;const c=this.game.playFieldLocked[i+s];if(l&&void 0===c)return!0;const n=this.game.playFieldLocked[i+s][e+h];if(l&&(void 0===n||0!==n))return!0}return!1}updatePosition(){const t=n(this.game.playFieldLocked),i=this.currentPiece.matrix;for(let e=0;e<i.length;e++)for(let s=0;s<i[e].length;s++){const h=i[e][s];h&&(t[this.y+e][this.x+s]=h)}return this.game.playFieldActive=t,t}lock(){const t=this.currentPiece.matrix;for(let i=0;i<t.length;i++)for(let e=0;e<t[i].length;e++){const s=t[i][e];s&&(this.game.playFieldLocked[this.y+i][this.x+e]=s)}this.reset(),this.currentPiece=this.nextPiece,this.positionCurrentPiece(),this.nextPiece=this.create()}}class d{constructor(t){this.score=0,this.scoreConfig=t}update(t,i){const e=this.scoreConfig[t]*i;this.score+=e}reset(){this.score=0}}class g{constructor(t,i,e,s){this.game=t,this.view=e,this.piece=i,this.timer=s}init(){document.addEventListener("keydown",(t=>{const i=t.code;switch(this.onArrowKeyHandler(i),i){case"Enter":this.onENTERHandler();break;case"Escape":this.onESCAPEHandler();break;default:return}}))}onArrowKeyHandler(t){if(this.game.playing){switch(t){case"ArrowLeft":this.piece.moveLeft();break;case"ArrowRight":this.piece.moveRight();break;case"ArrowUp":this.piece.rotate();break;case"ArrowDown":this.piece.moveDown();break;default:return}this.view.render()}}onESCAPEHandler(){this.game.playing&&(this.game.playing=!1,this.timer.stop())}onENTERHandler(){if(!this.game.playing){if(this.game.playing||this.game.isGameOver)return!this.game.playing&&this.game.isGameOver?(this.game.reset(),this.piece.init(),void this.timer.start()):void 0;this.timer.start()}}}class p{constructor(t,i,e){this.game=t,this.view=i,this.piece=e,this.timer=null}start(){const t=1100-100*this.game.level;this.view.render(),this.game.playing=!0,this.timer=setInterval((()=>this.play()),t)}play(){if(this.game.isGameOver)return this.stop(),void this.view.renderGameOverScreen();this.game.playing&&(this.piece.moveDown(),this.view.render())}stop(){clearInterval(this.timer),this.timer=null,this.game.playing=!1,this.view.renderPauseScreen()}}window.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>{(()=>{const t=document.querySelector(".loader");t&&t.classList.add("loader--inactive")})(),(()=>{const n=new d(s),m=new r(t,i,e,n),f=new a(m,h,e);f.init();const x=new o(m,f,n,document.querySelector(".app__game"),e,l,c);x.init();const y=new p(m,x,f);new g(m,f,x,y).init()})()}),3e3)})),window.FLS=!0,function(t){let i=new Image;i.onload=i.onerror=function(){t(2==i.height)},i.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}((function(t){let i=!0===t?"webp":"no-webp";document.documentElement.classList.add(i)}))})();